# Cloudflare Pages 部署指南

本文档提供了将JoyFun.space网站部署到Cloudflare Pages的详细步骤。

## 部署配置

在Cloudflare Pages的部署配置页面，请使用以下设置：

### 基本设置

- **项目名称**: `joyfun`（或您喜欢的任何名称）
- **生产分支**: `main`
- **框架预设**: `Next.js`
- **构建命令**: `npm run export`
- **构建输出目录**: `out`

### 环境变量（可选）

如果您需要设置环境变量，可以在"环境变量"部分添加。对于基本部署，不需要额外的环境变量。

## 特殊文件说明

项目中包含了几个专门针对Cloudflare Pages的配置文件：

1. **`public/_headers`**: 
   - 用于设置HTTP响应头
   - 替代了Next.js配置中的headers功能

2. **`public/_redirects`**: 
   - 配置URL重定向和代理
   - 替代了Next.js配置中的rewrites功能

3. **`public/sitemap.xml`**:
   - 静态站点地图文件
   - 包含网站所有重要页面的URL
   - 有助于搜索引擎索引您的网站

4. **`next.config.js`中的特殊配置**:
   - `trailingSlash: true`: 为所有URL添加尾部斜杠，有助于静态托管

## 静态导出说明

本项目使用Next.js的静态导出功能。以下是一些关于静态导出的重要说明：

1. **动态功能限制**:
   - 静态导出不支持服务器端渲染(SSR)和API路由
   - 所有页面在构建时预渲染为HTML文件

2. **动态内容替代方案**:
   - 任何需要动态内容的功能应使用客户端JavaScript实现
   - 可以使用第三方API服务代替Next.js API路由

3. **网站更新**:
   - 每次内容更新后都需要重新构建和部署

## 部署后验证

部署完成后，请检查以下内容以确保网站正常运行：

1. 所有页面都能正确加载
2. 游戏嵌入功能正常工作
3. 内部链接都能正确跳转
4. 图片和样式正确显示
5. 网站地图可以通过URL访问：https://joyfun.space/sitemap.xml

## 常见问题

### 域名设置

如果要使用自定义域名（如joyfun.space），请在Cloudflare Pages的"自定义域"部分进行设置。

### 缓存问题

如果遇到缓存问题，可以在Cloudflare Pages的"缓存"设置中配置缓存规则，或者添加适当的缓存控制标头到`_headers`文件中。

### 静态资源访问

确保所有静态资源（如图像、CSS、JavaScript文件）都放在`public`目录中，这样它们将被正确复制到输出目录。

## 更新网站

要更新网站内容，只需：

1. 修改代码或内容
2. 提交更改到GitHub仓库
3. Cloudflare Pages将自动检测到更改并重新部署

## 本地测试

在推送到GitHub之前，可以通过以下命令在本地测试静态导出:

```bash
npm run export
npx serve out
```

这将启动一个本地服务器，让您可以在浏览器中测试静态导出版本。

## 注意事项

1. 如果您将来需要添加新的游戏页面，请记得更新静态`sitemap.xml`文件，以确保新页面被搜索引擎正确索引。

2. 在本地测试时，您可能会看到一些404错误（如webpack-hmr请求），这些是正常的，不会影响网站的功能。

3. 确保所有必要的图标和favicon文件都包含在`public`目录中，以避免浏览器控制台中的错误消息。 